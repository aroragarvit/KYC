
> kyc_verifier@1.0.0 dev
> mastra dev

[32mINFO[39m [2025-04-19 12:22:11.060 +0530] (BUNDLER - Dev): [36mStarting watcher...[39m
[32mINFO[39m [2025-04-19 12:22:11.842 +0530] (BUNDLER - Dev): [36mBundling finished, starting server...[39m
[32mINFO[39m [2025-04-19 12:22:11.863 +0530] (Mastra CLI): [36m[Mastra Dev] - Starting server...[39m
[32mINFO[39m [2025-04-19 12:22:12.794 +0530] (Mastra): [36mü¶Ñ Mastra API running on port 4111/api[39m
[32mINFO[39m [2025-04-19 12:22:12.798 +0530] (Mastra): [36müìö Open API documentation available at http://localhost:4111/openapi.json[39m
[32mINFO[39m [2025-04-19 12:22:12.798 +0530] (Mastra): [36müß™ Swagger UI available at http://localhost:4111/swagger-ui[39m
[32mINFO[39m [2025-04-19 12:22:12.798 +0530] (Mastra): [36müë®‚Äçüíª Playground available at http://localhost:4111/[39m
Fetching documents...
Reading content for document 1: 00000000 Template - Engagement - Incorporation Form - PLC.pdf
Reading content for document 2: Director Appointment Truffles AI.docx
Reading content for document 3: Director Registry Truffles AI.docx
Reading content for document 4: John Doe Full.docx
Reading content for document 5: John Doe Passport Full.docx
Reading content for document 6: Proof of Address John Doe (3).docx
Reading content for document 7: Truffles AI Holdings Company Profile.docx
Reading content for document 8: Truffles AI Shareholder Registry.docx
Classifying 8 documents in a single batch...
Sending batch classification request to AI...
Received batch classification response from AI
Classified document 1: 00000000 Template - Engagement - Incorporation Form - PLC.pdf as other
Classified document 2: Director Appointment Truffles AI.docx as director_appointment
Classified document 3: Director Registry Truffles AI.docx as director_registry
Classified document 4: John Doe Full.docx as identity_document
Classified document 5: John Doe Passport Full.docx as identity_document
Classified document 6: Proof of Address John Doe (3).docx as proof_of_address
Classified document 7: Truffles AI Holdings Company Profile.docx as company_profile
Classified document 8: Truffles AI Shareholder Registry.docx as shareholder_registry
Extracting information from 8 documents...
Sending prompt to extract information...
Fetching documents...
Reading content for document 1: 00000000 Template - Engagement - Incorporation Form - PLC.pdf
Reading content for document 2: Director Appointment Truffles AI.docx
Reading content for document 3: Director Registry Truffles AI.docx
Reading content for document 4: John Doe Full.docx
Reading content for document 5: John Doe Passport Full.docx
Reading content for document 6: Proof of Address John Doe (3).docx
Reading content for document 7: Truffles AI Holdings Company Profile.docx
Reading content for document 8: Truffles AI Shareholder Registry.docx
Classifying 8 documents in a single batch...
All documents already have classifications. Skipping classification step.
Extracting information from 8 documents...
Sending prompt to extract information...
Received response, parsing...
Successfully extracted information about 4 individuals and 3 companies
Processing discrepancies in extracted data...
Storing extracted information...
Stored new individual: John Doe
Stored new individual: Alice Tan
Stored new individual: Michael Zhou
Stored new individual: Priya Khanna
Stored new company: Truffles AI Pte Ltd

=== Processing directors for company: Truffles AI Pte Ltd ===

COMPANY DETAILS TABLE
===================
a. Intended Company Name: Truffles AI Pte Ltd
b. Alternative Company Name 1: N/A
c. Alternative Company Name 2: N/A
d. Company Activities: [object Object]
e. Intended Registered Address: Unknown

DIRECTORS TABLE
==============
| Name (Source) | ID No. (Source) | ID Type (Source) | Nationality (Source) | Residential Address (Source) | Tel. No. (Source) | Email Address (Source) | Verification Status | KYC Status |
|---------------|-----------------|------------------|--------------------|-----------------------------|------------------|---------------------|-------------------|-------------|
| John Doe (No source) | S8888999C (director_registry (Director Registry Truffles AI.docx)) | NRIC (identity_document (John Doe Full.docx)) | Singaporean (director_registry (Director Registry Truffles AI.docx)) | 10 Marina Bay Sands, Tower 3, #25-02, Singapore 018956 (director_registry (Director Registry Truffles AI.docx)) | +65 9000 1234 (director_registry (Director Registry Truffles AI.docx)) | john.doe@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | not_verified | Discrepancy in id_numbers: S8888999C vs S1234567D vs X1234567 (Sources: Director Registry Truffles AI.docx, John Doe Full.docx, John Doe Passport Full.docx); Discrepancy in id_types: NRIC vs Passport (Sources: John Doe Full.docx, John Doe Passport Full.docx); Discrepancy in nationalities: Singaporean vs United States of America (Sources: Director Registry Truffles AI.docx, John Doe Full.docx, John Doe Passport Full.docx); Discrepancy in addresses: 10 Marina Bay Sands, Tower 3, #25-02, Singapore 018956 vs 123 Orchard Road, #10-01, Singapore 238888 (Sources: Director Registry Truffles AI.docx, John Doe Full.docx, Proof of Address John Doe (3).docx) |
| Alice Tan (No source) | S1234567A (director_registry (Director Registry Truffles AI.docx)) | Missing (No source) | Singaporean (director_registry (Director Registry Truffles AI.docx)) | 21 Bukit Timah Road, #05-01, Singapore 229837 (director_registry (Director Registry Truffles AI.docx)) | +65 9123 4567 (director_registry (Director Registry Truffles AI.docx)) | alice.tan@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | pending | Missing identification document; Missing proof of address |
| Michael Zhou (No source) | P0987654B (director_registry (Director Registry Truffles AI.docx)) | Missing (No source) | American (director_registry (Director Registry Truffles AI.docx)) | 500 Market Street, San Francisco, CA, USA (director_registry (Director Registry Truffles AI.docx)) | +1 415 123 4567 (director_registry (Director Registry Truffles AI.docx)) | michael.zhou@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | pending | Missing identification document; Missing proof of address |
| Priya Khanna (No source) | A1122334Z (director_registry (Director Registry Truffles AI.docx)) | Missing (No source) | Indian (director_registry (Director Registry Truffles AI.docx)) | 401 Residency Road, Bengaluru, Karnataka, India (director_registry (Director Registry Truffles AI.docx)) | +91 98450 12345 (director_registry (Director Registry Truffles AI.docx)) | priya.khanna@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | pending | Missing identification document; Missing proof of address |

Company Verification Status: pending

=== End of Processing ===

Stored new company: Truffles AI Holdings Ltd

=== Processing directors for company: Truffles AI Holdings Ltd ===

COMPANY DETAILS TABLE
===================
a. Intended Company Name: Truffles AI Holdings Ltd
b. Alternative Company Name 1: N/A
c. Alternative Company Name 2: N/A
d. Company Activities: [object Object]
e. Intended Registered Address: 14 Palm Grove, Roadtown, Tortola, BVI

DIRECTORS TABLE
==============
| Name (Source) | ID No. (Source) | ID Type (Source) | Nationality (Source) | Residential Address (Source) | Tel. No. (Source) | Email Address (Source) | Verification Status | KYC Status |
|---------------|-----------------|------------------|--------------------|-----------------------------|------------------|---------------------|-------------------|-------------|
| Alice Tan (No source) | S1234567A (director_registry (Director Registry Truffles AI.docx)) | Missing (No source) | Singaporean (director_registry (Director Registry Truffles AI.docx)) | 21 Bukit Timah Road, #05-01, Singapore 229837 (director_registry (Director Registry Truffles AI.docx)) | +65 9123 4567 (director_registry (Director Registry Truffles AI.docx)) | alice.tan@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | pending | Missing identification document; Missing proof of address |
| Michael Zhou (No source) | P0987654B (director_registry (Director Registry Truffles AI.docx)) | Missing (No source) | American (director_registry (Director Registry Truffles AI.docx)) | 500 Market Street, San Francisco, CA, USA (director_registry (Director Registry Truffles AI.docx)) | +1 415 123 4567 (director_registry (Director Registry Truffles AI.docx)) | michael.zhou@truffles.ai (director_registry (Director Registry Truffles AI.docx)) | pending | Missing identification document; Missing proof of address |

Company Verification Status: pending

=== End of Processing ===

Stored new company: Truffles AI Research Inc

=== Processing directors for company: Truffles AI Research Inc ===

COMPANY DETAILS TABLE
===================
a. Intended Company Name: Truffles AI Research Inc
b. Alternative Company Name 1: N/A
c. Alternative Company Name 2: N/A
d. Company Activities: [object Object]
e. Intended Registered Address: Unknown
No directors found for this company

Generating summary tables...
Generated tables and saved to output directory.
Received response, parsing...
Error parsing JSON: SyntaxError: Expected double-quoted property name in JSON at position 4437
    at JSON.parse (<anonymous>)
    at execute (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:3103:36)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4489:16
    at async handler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4515:28)
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4489:16
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2362:20
Error extracting information: Error: Failed to parse extracted information
    at execute (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:3110:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4489:16
    at async handler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4515:28)
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:4489:16
    at async file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2362:20
Unhandled Rejection at: Promise {
  <rejected> TypeError [ERR_INVALID_STATE]: Invalid state: Controller is already closed
      at ReadableStreamDefaultController.enqueue (node:internal/webstreams/readablestream:1051:13)
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:12247:22
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3297:16
      at Set.forEach (<anonymous>)
      at Machine.stateUpdateHandler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3296:32)
      at Machine.emit (node:events:519:28)
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2176:14
      at Actor.update (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:636:28)
      at Actor._process (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:880:10)
      at Mailbox.flush (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:45:12) {
    code: 'ERR_INVALID_STATE'
  },
  [Symbol(async_id_symbol)]: 28909,
  [Symbol(trigger_async_id_symbol)]: 15994,
  [Symbol(kResourceStore)]: BaseContext {
    _currentContext: Map(3) {
      Symbol(OpenTelemetry Context Key SPAN) => [Span],
      Symbol(OpenTelemetry SDK Context Key RPC_METADATA) => [Object],
      Symbol(OpenTelemetry Baggage Key) => [Object]
    },
    getValue: [Function (anonymous)],
    setValue: [Function (anonymous)],
    deleteValue: [Function (anonymous)]
  }
} reason: TypeError [ERR_INVALID_STATE]: Invalid state: Controller is already closed
    at ReadableStreamDefaultController.enqueue (node:internal/webstreams/readablestream:1051:13)
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:12247:22
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3297:16
    at Set.forEach (<anonymous>)
    at Machine.stateUpdateHandler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3296:32)
    at Machine.emit (node:events:519:28)
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2176:14
    at Actor.update (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:636:28)
    at Actor._process (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:880:10)
    at Mailbox.flush (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:45:12) {
  code: 'ERR_INVALID_STATE'
}
Unhandled Rejection at: Promise {
  <rejected> TypeError [ERR_INVALID_STATE]: Invalid state: Controller is already closed
      at ReadableStreamDefaultController.enqueue (node:internal/webstreams/readablestream:1051:13)
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:12247:22
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3297:16
      at Set.forEach (<anonymous>)
      at Machine.stateUpdateHandler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3296:32)
      at Machine.emit (node:events:519:28)
      at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2176:14
      at Actor.update (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:636:28)
      at Actor._process (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:880:10)
      at Mailbox.flush (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:45:12) {
    code: 'ERR_INVALID_STATE'
  },
  [Symbol(async_id_symbol)]: 28909,
  [Symbol(trigger_async_id_symbol)]: 15994,
  [Symbol(kResourceStore)]: BaseContext {
    _currentContext: Map(3) {
      Symbol(OpenTelemetry Context Key SPAN) => [Span],
      Symbol(OpenTelemetry SDK Context Key RPC_METADATA) => [Object],
      Symbol(OpenTelemetry Baggage Key) => [Object]
    },
    getValue: [Function (anonymous)],
    setValue: [Function (anonymous)],
    deleteValue: [Function (anonymous)]
  }
} reason: TypeError [ERR_INVALID_STATE]: Invalid state: Controller is already closed
    at ReadableStreamDefaultController.enqueue (node:internal/webstreams/readablestream:1051:13)
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:12247:22
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3297:16
    at Set.forEach (<anonymous>)
    at Machine.stateUpdateHandler (file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:3296:32)
    at Machine.emit (node:events:519:28)
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/@mastra/core/dist/chunk-FFOLLSHP.js:2176:14
    at Actor.update (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:636:28)
    at Actor._process (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:880:10)
    at Mailbox.flush (/home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/node_modules/xstate/dist/raise-60cebf03.cjs.js:45:12) {
  code: 'ERR_INVALID_STATE'
}
Unhandeled rejection
[32mINFO[39m [2025-04-19 12:30:27.941 +0530] (Mastra CLI): [36m[Mastra Dev] - Bundling finished, restarting server...[39m
[34mDEBUG[39m [2025-04-19 12:30:27.941 +0530] (Mastra CLI): [36mStopping current server...[39m
[32mINFO[39m [2025-04-19 12:30:27.944 +0530] (Mastra CLI): [36m[Mastra Dev] - Starting server...[39m
file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:3358
}).step(fetchDocuments).then(readDocumentContents).then(classifyDocuments).then(extractInformation).then(processDiscrepancies).then(storeInformation).then(generateSummaryTables);
                                                                                                                                                           ^

ReferenceError: generateSummaryTables is not defined
    at file:///home/garvit/Desktop/personal_projects/KYC_Agent/KYC_Verifier/.mastra/output/index.mjs:3358:156
    at ModuleJob.run (node:internal/modules/esm/module_job:222:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:316:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:123:5)

Node.js v20.16.0
[31mERROR[39m [2025-04-19 12:30:30.456 +0530] (Mastra CLI): [36mServer failed to start with error:[39m
    message: null
